{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "CoplandTerm",
    "description": "Copland protocol term structure",
    "type": "object", 
    "oneOf": [{ "$ref": "#/$defs/aspTerm" }, 
              { "$ref": "#/$defs/lseqTerm" }, 
              { "$ref": "#/$defs/bseqTerm" },
              { "$ref": "#/$defs/attTerm" }], 

    "$defs": {

        "splitTuple": {"type":"array", 
                       "prefixItems": [ { "$ref": "#/$defs/spEnum" }, 
                                        { "$ref": "#/$defs/spEnum" } ],
                       "minItems": 2 },
        "spEnum": {"type":"string", 
                   "oneOf": [{ "const": "ALL" }, 
                             { "const": "NONE" }]
                  },

        "attTerm": {
            "type": "object",
            "properties": {
                "TERM_CONSTRUCTOR": {"const": "att"}, 
                "TERM_BODY": {"type": "array", 
                              "prefixItems": [ { "type":"string" }, { "$ref": "#" } ], 
                              "minItems": 2
                            }
            },
            "required": ["TERM_CONSTRUCTOR", "TERM_BODY"]
        },
        "bseqTerm": {
            "type": "object",
            "properties": {
                "TERM_CONSTRUCTOR": {"const": "bseq"}, 
                "TERM_BODY": {"type": "array", 
                              "prefixItems": [ { "$ref": "#/$defs/splitTuple" }, { "$ref": "#" }, { "$ref": "#" } ], 
                              "minItems": 3
                            }
            },
            "required": ["TERM_CONSTRUCTOR", "TERM_BODY"]
        },

        "lseqTerm": {
            "type": "object",
            "properties": {
                "TERM_CONSTRUCTOR": {"const": "lseq"}, 
                "TERM_BODY": {"type": "array", 
                              "prefixItems": [ { "$ref": "#" }, { "$ref": "#" } ], 
                              "minItems": 2
                            }
            },
            "required": ["TERM_CONSTRUCTOR", "TERM_BODY"]
        },

        "aspTerm": {
            "type": "object",
            "properties": {
                "TERM_CONSTRUCTOR": {"const": "asp"}, 
                "TERM_BODY": {"type":"object",
                              "oneOf": [ { "$ref": "#/$defs/aspcTerm" }, 
                                         { "$ref": "#/$defs/apprcTerm" } ]}
            },
            "required": ["TERM_CONSTRUCTOR", "TERM_BODY"]
        }, 

        "fwd": { "enum": ["REPLACE", "WRAP", "UNWRAP", "EXTEND"] },

        "evInSig": { "enum": ["ALL", "NONE"] },

        "evOutSig": {"type":"object", 
                     "properties": {
                        "EvOutSig_CONSTRUCTOR": { "enum": ["OutN"] },
                        "EvOutSig_BODY": { "type": "number" }
                     }, 
                     "required": ["EvOutSig_CONSTRUCTOR"]
                    },

        "aspType" : { "type": "object", 
                      "properties": {
                        "FWD": { "$ref": "#/$defs/fwd" },
                        "EvInSig": { "$ref": "#/$defs/evInSig" },
                        "EvOutSig": { "$ref": "#/$defs/evOutSig" }
                      }, 
                      "requried": ["FWD", "EvInSig", "EvOutSig"]
                    },
        "aspArgs": {"type": "object", 
                            "properties": {
                                "ASP_ID": {"type": "string"},
                                "ASP_ARGS": {"type": "object"},
                                "ASP_PLC": {"type": "string"},
                                "ASP_TARG_ID": {"type": "string"}
                            }, 
                            "required": ["ASP_ID"]
                },

        "aspcTerm": {
            "type": "object",
            "properties": {
                "ASP_CONSTRUCTOR": {"const": "ASPC"}, 
                "ASP_BODY": { "$ref": "#/$defs/aspArgs" }
            }, 
            "required": ["ASP_CONSTRUCTOR", "ASP_BODY"]
        }, 
        "apprcTerm": {
            "type": "object",
            "properties": {
                "ASP_CONSTRUCTOR": {"const": "APPR"}
            }, 
            "required": ["ASP_CONSTRUCTOR"]
        }

  }
}
